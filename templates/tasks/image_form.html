{% extends 'base.html' %}
{% load static %}

{% block title %}ğŸ“¸ Ù…Ù‡Ø§Ù… ØªØ­ØªØ§Ø¬ ØµÙˆØ±{% endblock %}

{% block extra_css %}
<link rel="stylesheet" href="{% static 'css/tasks.css' %}">
{% endblock %}

{% block content %}
<div class="task-container">
  <h1>ğŸ“¸ Ù‚Ø§Ø¦Ù…Ø© Ø§Ù„Ù…Ù‡Ø§Ù… Ø§Ù„ØªÙŠ ØªØ­ØªØ§Ø¬ ØµÙˆØ±</h1>

  <!-- Ù†Ù…ÙˆØ°Ø¬ Ø§Ù„ÙÙ„ØªØ±Ø© -->
  <form method="get" class="task-filter-form">
    <label>
      Ø¨Ø­Ø«:
      <input type="text" name="q" placeholder="Ø§Ø¨Ø­Ø« Ø¹Ù† Ø¹Ù†ÙˆØ§Ù† Ø£Ùˆ ÙƒØ§ØªØ¨..." value="{{ search_query|default:'' }}">
    </label>

    <label>
      Ø§Ù„ÙƒØ§ØªØ¨:
      <select name="writer">
        <option value="">-- Ø§Ù„ÙƒÙ„ --</option>
        {% for id, full_name in writers %}
          <option value="{{ id }}" {% if id|stringformat:"s" == selected_writer|stringformat:"s" %}selected{% endif %}>
          {{ full_name }} </option>
        {% endfor %}
      </select>
    </label>

    <label>
      Ø§Ù„Ø­Ø§Ù„Ø©:
      <select name="image_status">
        <option value="">-- Ø§Ù„ÙƒÙ„ --</option>
        {% for id, name in image_status %}
          <option value="{{ id }}" {% if id|stringformat:"s" == selected_status %}selected{% endif %}>{{ name }}</option>
         {% endfor %}
      </select>
    </label>

    <label>
      Ù…ÙˆÙ‚Ø¹ Ø§Ù„Ù†Ø´Ø±:
      <select name="site">
        <option value="">-- Ø§Ù„ÙƒÙ„ --</option>
        {% for id, name in sites %}
          <option value="{{ id }}" {% if id|stringformat:"s" == selected_site %}selected{% endif %}>{{ name }}</option>
        {% endfor %}
      </select>
    </label>

    <button type="submit">ğŸ” ØªØµÙÙŠØ©</button>
    <a href="{% url 'image_form' %}" class="reset-filter">ğŸ”„ Ø¥Ø¹Ø§Ø¯Ø© ØªØ¹ÙŠÙŠÙ†</a>
  </form>

  <!-- Ø¬Ø¯ÙˆÙ„ Ø§Ù„Ù…Ù‡Ø§Ù… -->
  {% if tasks %}
    <table class="task-table">
      <thead>
        <tr>
          <th>âœï¸ Ø§Ù„ÙƒØ§ØªØ¨</th>
          <th>ğŸ“… Ø¨Ø±ÙŠØ¯ Ø§Ù„ÙƒØ§ØªØ¨</th>
          <th>ğŸ“¢ Ù…ÙˆÙ‚Ø¹ Ø§Ù„Ù†Ø´Ø±</th>
          <th>ğŸ–¼ï¸ Ø§Ù„ØµÙˆØ±Ø© Ø§Ù„Ù…Ø·Ù„ÙˆØ¨Ø©</th>
          <th>ğŸ“Œ Ø­Ø§Ù„Ø© Ø§Ù„ØµÙˆØ±Ø©</th>
          <th>ğŸ“ ØªÙØ§ØµÙŠÙ„ Ø§Ù„ØµÙˆØ±Ø©</th>
          <th>âš™ï¸ Ø§Ù„Ù…Ø²ÙŠØ¯</th>
        </tr>
      </thead>
      <tbody>
        {% for task in tasks %}
          <tr>
            <td>{{ task.writer.get_full_name|default:task.writer.username }}</td>
            <td>{{ task.writer.email|default:task.writer.username }}</td>
            <td>{{ task.publish_site }}</td>
            <td>{{ task.image|default:"-" }}</td>
            <td>
              <form method="post" action="{% url 'update_image_status' task.id %}">
                {% csrf_token %}
                <select name="image_status" onchange="this.form.submit()" class="status-select">
                   {% for value, label in image_status %}
                      <option value="{{ value }}" {% if task.image_status == value %}selected{% endif %}>{{ label }}</option>
                   {% endfor %}
                </select>
             </form>
           </td>

            <td>{{ task.image_details|default:"-" }}</td>
            <td>
              <a href="{% url 'task_details' task.id %}" target="_blank" class="view-btn">ğŸ‘ï¸ Ø¹Ø±Ø¶</a>
            </td>
          </tr>
        {% endfor %}
      </tbody>
    </table>
  {% else %}
    <p>âœ… Ù„Ø§ ØªÙˆØ¬Ø¯ Ù…Ù‡Ø§Ù… ØªØ­ØªØ§Ø¬ ØµÙˆØ± Ø­Ø§Ù„ÙŠØ§Ù‹.</p>
  {% endif %}
</div>

<!-- Ø§Ù„Ø¨Ø§Ø¬ÙŠÙ†Ø§Ø´Ù† -->
<div class="pagination">
  {% if page_obj.has_previous %}
    <a href="?page=1
      {% if search_query %}&q={{ search_query }}{% endif %}
      {% if selected_writer %}&writer={{ selected_writer }}{% endif %}
      {% if selected_status %}&status={{ selected_status }}{% endif %}
      {% if selected_site %}&site={{ selected_site }}{% endif %}
    ">Ø§Ù„Ø£ÙˆÙ„Ù‰</a>

    <a href="?page={{ page_obj.previous_page_number }}
      {% if search_query %}&q={{ search_query }}{% endif %}
      {% if selected_writer %}&writer={{ selected_writer }}{% endif %}
      {% if selected_status %}&status={{ selected_status }}{% endif %}
      {% if selected_site %}&site={{ selected_site }}{% endif %}
    ">Ø§Ù„Ø³Ø§Ø¨Ù‚</a>
  {% endif %}

  <span>ØµÙØ­Ø© {{ page_obj.number }} Ù…Ù† {{ page_obj.paginator.num_pages }}</span>

  {% if page_obj.has_next %}
    <a href="?page={{ page_obj.next_page_number }}
      {% if search_query %}&q={{ search_query }}{% endif %}
      {% if selected_writer %}&writer={{ selected_writer }}{% endif %}
      {% if selected_status %}&status={{ selected_status }}{% endif %}
      {% if selected_site %}&site={{ selected_site }}{% endif %}
    ">Ø§Ù„ØªØ§Ù„ÙŠ</a>

    <a href="?page={{ page_obj.paginator.num_pages }}
      {% if search_query %}&q={{ search_query }}{% endif %}
      {% if selected_writer %}&writer={{ selected_writer }}{% endif %}
      {% if selected_status %}&status={{ selected_status }}{% endif %}
      {% if selected_site %}&site={{ selected_site }}{% endif %}
    ">Ø§Ù„Ø£Ø®ÙŠØ±Ø©</a>
  {% endif %}
</div>
{% endblock %}
