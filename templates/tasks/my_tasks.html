{% extends 'base.html' %}
{% load static %}

{% block extra_css %}
  <link rel="stylesheet" href="{% static 'css/my_tasks.css' %}">
  <title>Ù…Ù‡Ø§Ù…ÙŠ - Ù†Ø¸Ø§Ù… Ø¥Ø¯Ø§Ø±Ø© Ø§Ù„Ù…Ù‡Ø§Ù…</title>
  <meta name="title" content="Ù…Ù‡Ø§Ù…ÙŠ - Ù†Ø¸Ø§Ù… Ø¥Ø¯Ø§Ø±Ø© Ø§Ù„Ù…Ù‡Ø§Ù…">
  <meta name="description" content="Ø§Ø³ØªØ¹Ø±Ø¶ Ù…Ù‡Ø§Ù…Ùƒ Ø§Ù„Ø´Ø®ØµÙŠØ© ÙÙŠ Ù†Ø¸Ø§Ù… Ø¥Ø¯Ø§Ø±Ø© Ø§Ù„Ù…Ù‡Ø§Ù…. Ù‚Ù… Ø¨ØªØµÙÙŠØ© Ø§Ù„Ù…Ù‡Ø§Ù… Ø­Ø³Ø¨ Ø§Ù„Ø­Ø§Ù„Ø© Ø£Ùˆ Ù…ÙˆÙ‚Ø¹ Ø§Ù„Ù†Ø´Ø±ØŒ ÙˆØ§Ø¨Ù‚Ù Ø¹Ù„Ù‰ Ø§Ø·Ù„Ø§Ø¹ Ø¯Ø§Ø¦Ù… Ø¨ØªØ­Ø¯ÙŠØ«Ø§Øª Ù…Ù‡Ø§Ù…Ùƒ.">
{% endblock %}

{% block content %}
<div class="container">
  <h1 class="page-title">ğŸ“Œ Ù…Ù‡Ø§Ù…ÙŠ</h1>

  {% if messages %}
    <div class="messages" role="alert">
      {% for message in messages %}
        <div class="alert {% if message.tags %}{{ message.tags }}{% endif %}">
          {{ message }}
        </div>
      {% endfor %}
    </div>
  {% endif %}

  <form method="get" class="task-filter-form" aria-label="ØªØµÙÙŠØ© Ø§Ù„Ù…Ù‡Ø§Ù…">
    <label>
      Ø¨Ø­Ø«:
      <input type="text" name="q" placeholder="Ø§Ø¨Ø­Ø« Ø¹Ù† Ø¹Ù†ÙˆØ§Ù† Ø£Ùˆ ÙƒØ§ØªØ¨..." value="{{ search_query|default:'' }}" aria-label="Ø§Ù„Ø¨Ø­Ø« Ø¹Ù† Ù…Ù‡Ø§Ù…">
    </label>
    
    <label>
      Ø§Ù„Ø­Ø§Ù„Ø©:
      <select name="status" aria-label="ØªØµÙÙŠØ© Ø­Ø³Ø¨ Ø§Ù„Ø­Ø§Ù„Ø©">
        <option value="">-- Ø§Ù„ÙƒÙ„ --</option>
        <option value="in_progress" {% if selected_status == "in_progress" %}selected{% endif %}>â³ Ø¬Ø§Ø±ÙŠ</option>
        <option value="upload" {% if selected_status == "upload" %}selected{% endif %}>ğŸ“¤ ØªÙ… Ø§Ù„Ø±ÙØ¹</option>
        <option value="publish" {% if selected_status == "publish" %}selected{% endif %}>ğŸ“¢ ØªÙ… Ø§Ù„Ù†Ø´Ø±</option>
        <option value="done" {% if selected_status == "done" %}selected{% endif %}>âœ… Ù…ÙƒØªÙ…Ù„Ø©</option>
      </select>
    </label>

    <label>
      Ù…ÙˆÙ‚Ø¹ Ø§Ù„Ù†Ø´Ø±:
      <select name="site" aria-label="ØªØµÙÙŠØ© Ø­Ø³Ø¨ Ù…ÙˆÙ‚Ø¹ Ø§Ù„Ù†Ø´Ø±">
        <option value="">-- Ø§Ù„ÙƒÙ„ --</option>
        {% for id, name in sites %}
          <option value="{{ id }}" {% if id|stringformat:"s" == selected_site %}selected{% endif %}>{{ name }}</option>
        {% endfor %}
      </select>
    </label>

    <button type="submit">ğŸ” ØªØµÙÙŠØ©</button>
    <a href="{% url 'my_tasks' %}" class="reset-filter">ğŸ”„ Ø¥Ø¹Ø§Ø¯Ø© ØªØ¹ÙŠÙŠÙ†</a>
  </form>

  <div class="task-table-container" id="tableContainer">
    <table class="task-table" role="table" aria-label="Ù‚Ø§Ø¦Ù…Ø© Ø§Ù„Ù…Ù‡Ø§Ù…">
      <thead>
        <tr>
          <th scope="col">Ø¹Ù†ÙˆØ§Ù† Ø§Ù„Ù…Ù‚Ø§Ù„</th>
          <th scope="col">[Ø§Ù„Ù†ÙˆØ¹]</th>
          <th scope="col">Ø§Ù„ØªÙØ§ØµÙŠÙ„</th>
          <th scope="col">Ø±Ø§Ø¨Ø· Ø§Ù„Ù…Ù‚Ø§Ù„</th>
          <th scope="col">Ù…ÙˆÙ‚Ø¹ Ø§Ù„Ù†Ø´Ø±</th>
          <th scope="col">ØªØ§Ø±ÙŠØ® Ø§Ù„Ù†Ø´Ø±</th>
          <th scope="col">Ø§Ù„Ø­Ø§Ù„Ø©</th>
          <th scope="col">Ø¹Ø±Ø¶ Ø§Ù„Ù…Ø²ÙŠØ¯</th>
        </tr>
      </thead>
      <tbody>
        {% for task in tasks %}
          <tr>
            <td data-label="Ø¹Ù†ÙˆØ§Ù† Ø§Ù„Ù…Ù‚Ø§Ù„">{{ task.article_title }}</td>
            <td data-label="Ø§Ù„Ù†ÙˆØ¹">{{ task.article_type_W_R_A_B }}</td>
            <td data-label="Ø§Ù„ØªÙØ§ØµÙŠÙ„">{{ task.article_details }}</td>
            <td data-label="Ø±Ø§Ø¨Ø· Ø§Ù„Ù…Ù‚Ø§Ù„">
              <form method="post" action="{% url 'update_article_link' task.id %}" class="article-link-form">
                {% csrf_token %}
                <input type="url" name="article_link" value="{{ task.article_link|default:'' }}" placeholder="Ø£Ø¯Ø®Ù„ Ø§Ù„Ø±Ø§Ø¨Ø·" required aria-label="Ø±Ø§Ø¨Ø· Ø§Ù„Ù…Ù‚Ø§Ù„">
                <button type="submit">ğŸ’¾ Ø­ÙØ¸</button>
              </form>
            </td>
            <td data-label="Ù…ÙˆÙ‚Ø¹ Ø§Ù„Ù†Ø´Ø±">{{ task.publish_site }}</td>
            <td data-label="ØªØ§Ø±ÙŠØ® Ø§Ù„Ù†Ø´Ø±">{{ task.publish_date|default:"-" }}</td>
            <td data-label="Ø§Ù„Ø­Ø§Ù„Ø©">
              <form method="post" action="{% url 'update_task_status' task.id %}">
                {% csrf_token %}
                <select name="status" onchange="this.form.submit()" class="status-select" aria-label="ØªØ­Ø¯ÙŠØ« Ø­Ø§Ù„Ø© Ø§Ù„Ù…Ù‡Ù…Ø©">
                  <option value="in_progress" {% if task.status == 'in_progress' %}selected{% endif %}>â³ Ø¬Ø§Ø±ÙŠ Ø§Ù„Ø¹Ù…Ù„</option>
                  <option value="upload" {% if task.status == 'upload' %}selected{% endif %}>ğŸ“¤ ØªÙ… Ø§Ù„Ø±ÙØ¹</option>
                  <option value="publish" {% if task.status == 'publish' %}selected{% endif %}>ğŸ“¢ ØªÙ… Ø§Ù„Ù†Ø´Ø±</option>
                  <option value="done" {% if task.status == 'done' %}selected{% endif %}>âœ… Ù…ÙƒØªÙ…Ù„Ø©</option>
                </select>
              </form>
            </td>
            <td data-label="Ø¹Ø±Ø¶ Ø§Ù„Ù…Ø²ÙŠØ¯">
              <a href="{% url 'task_details' task.id %}" target="_blank" rel="noopener noreferrer" class="view-btn">ğŸ‘ï¸ Ø¹Ø±Ø¶</a>
            </td>
          </tr>
        {% empty %}
          <tr>
            <td colspan="8" class="no-tasks">Ù„Ø§ ØªÙˆØ¬Ø¯ Ù…Ù‡Ø§Ù… Ø­Ø§Ù„ÙŠØ§Ù‹.</td>
          </tr>
        {% endfor %}
      </tbody>
    </table>
  </div>

  {% if is_paginated %}
    <nav class="pagination" aria-label="ØªØµÙØ­ Ø§Ù„ØµÙØ­Ø§Øª">
      <ul>
        {% if page_obj.has_previous %}
          <li>
            <a href="?page=1{% if request.GET.q %}&q={{ request.GET.q }}{% endif %}{% if request.GET.status %}&status={{ request.GET.status }}{% endif %}{% if request.GET.site %}&site={{ request.GET.site }}{% endif %}" aria-label="Ø§Ù„ØµÙØ­Ø© Ø§Ù„Ø£ÙˆÙ„Ù‰">
              â®ï¸ Ø§Ù„Ø£ÙˆÙ„Ù‰
            </a>
          </li>
          <li>
            <a href="?page={{ page_obj.previous_page_number }}{% if request.GET.q %}&q={{ request.GET.q }}{% endif %}{% if request.GET.status %}&status={{ request.GET.status }}{% endif %}{% if request.GET.site %}&site={{ request.GET.site }}{% endif %}" aria-label="Ø§Ù„ØµÙØ­Ø© Ø§Ù„Ø³Ø§Ø¨Ù‚Ø©">
              â—€ï¸ Ø§Ù„Ø³Ø§Ø¨Ù‚
            </a>
          </li>
        {% endif %}

        {% for num in page_obj.paginator.page_range %}
          {% if page_obj.number == num %}
            <li><strong aria-current="page">{{ num }}</strong></li>
          {% elif num > page_obj.number|add:'-3' and num < page_obj.number|add:'3' %}
            <li>
              <a href="?page={{ num }}{% if request.GET.q %}&q={{ request.GET.q }}{% endif %}{% if request.GET.status %}&status={{ request.GET.status }}{% endif %}{% if request.GET.site %}&site={{ request.GET.site }}{% endif %}" aria-label="Ø§Ù„ØµÙØ­Ø© {{ num }}">
                {{ num }}
              </a>
            </li>
          {% endif %}
        {% endfor %}

        {% if page_obj.has_next %}
          <li>
            <a href="?page={{ page_obj.next_page_number }}{% if request.GET.q %}&q={{ request.GET.q }}{% endif %}{% if request.GET.status %}&status={{ request.GET.status }}{% endif %}{% if request.GET.site %}&site={{ request.GET.site }}{% endif %}" aria-label="Ø§Ù„ØµÙØ­Ø© Ø§Ù„ØªØ§Ù„ÙŠØ©">
              Ø§Ù„ØªØ§Ù„ÙŠ â–¶ï¸
            </a>
          </li>
          <li>
            <a href="?page={{ page_obj.paginator.num_pages }}{% if request.GET.q %}&q={{ request.GET.q }}{% endif %}{% if request.GET.status %}&status={{ request.GET.status }}{% endif %}{% if request.GET.site %}&site={{ request.GET.site }}{% endif %}" aria-label="Ø§Ù„ØµÙØ­Ø© Ø§Ù„Ø£Ø®ÙŠØ±Ø©">
              â­ï¸ Ø§Ù„Ø£Ø®ÙŠØ±Ø©
            </a>
          </li>
        {% endif %}
      </ul>
      
      <div class="pagination-info" aria-live="polite">
        ØµÙØ­Ø© {{ page_obj.number }} Ù…Ù† {{ page_obj.paginator.num_pages }}
      </div>
    </nav>
  {% endif %}
</div>
{% endblock %}