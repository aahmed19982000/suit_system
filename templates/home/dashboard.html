{% extends 'base.html' %}
{% load static %}

{% block title %}Ù„ÙˆØ­Ø© Ø§Ù„ØªØ­ÙƒÙ… - Ù…Ù„Ø®Øµ Ø§Ù„ÙˆØ±Ø¯ÙŠØ©{% endblock %}

{% block extra_css %}
<link rel="stylesheet" href="{% static 'css/dashboard.css' %}">
<link href="https://fonts.googleapis.com/css2?family=Cairo:wght@400;600;700&display=swap" rel="stylesheet">
<style>
    .dashboard-wrapper { direction: rtl; font-family: 'Cairo', sans-serif; }
    .stat-info strong, .item-name-row span, .total strong { color: #2c3e50 !important; }
    .trend-up { color: #2ecc71 !important; font-weight: bold; }
    .trend-down { color: #e74c3c !important; font-weight: bold; }
    .status-badge { padding: 4px 10px; border-radius: 20px; font-size: 0.8rem; font-weight: bold; background: #f0f2f5; }
</style>
{% endblock %}

{% block content %}
<div class="dashboard-wrapper">
    <header class="main-header">
        <div class="header-right">
            <a href="#" class="btn-add-order" style="text-decoration: none;">+ Ø·Ù„Ø¨ Ø¬Ø¯ÙŠØ¯</a>
            <div class="notification-icon">
                <span class="dot"></span>
                <i class="bell-icon">ğŸ””</i>
            </div>
        </div>
        <div class="header-left">
            <h2>Ù…Ù„Ø®Øµ Ø§Ù„ÙˆØ±Ø¯ÙŠØ©</h2>
            <p>{{ today_date|date:"lØŒ d F Y" }}</p>
        </div>
    </header>

    <section class="stats-row">
        <div class="stat-card">
            <div class="stat-icon blue-bg">S</div>
            <div class="stat-info">
                <span>Ø§Ù„Ù…Ø¨ÙŠØ¹Ø§Øª Ø§Ù„ÙŠÙˆÙ…ÙŠØ©</span>
                <strong>{{ total_sales|default:"0" }} Ø¬.Ù…</strong>
                <small class="{% if growth_rate >= 0 %}trend-up{% else %}trend-down{% endif %}">
                    {% if growth_rate >= 0 %}â†‘{% else %}â†“{% endif %} {{ abs_growth_rate }}% Ø¹Ù† Ø§Ù„Ø£Ù…Ø³
                </small>
            </div>
        </div>
        <div class="stat-card">
            <div class="stat-icon orange-bg">ğŸ“‹</div>
            <div class="stat-info">
                <span>Ø§Ù„Ø·Ù„Ø¨Ø§Øª Ø§Ù„ÙƒÙ„ÙŠØ©</span>
                <strong>{{ total_orders_count }} Ø·Ù„Ø¨</strong>
                <small>Ù…Ù†Ø° Ø¨Ø¯Ø§ÙŠØ© Ø§Ù„ÙˆØ±Ø¯ÙŠØ©</small>
            </div>
        </div>
        <div class="stat-card">
            <div class="stat-icon yellow-bg">ğŸ </div>
            <div class="stat-info">
                <span>Ù‚ÙŠØ¯ Ø§Ù„ØªØ­Ø¶ÙŠØ±</span>
                <strong>{{ preparing_orders_count }} Ø·Ù„Ø¨Ø§Øª</strong>
                <small class="warning-text">ØªØ­ØªØ§Ø¬ Ø§Ù†ØªØ¨Ø§Ù‡</small>
            </div>
        </div>
        <div class="stat-card">
            <div class="stat-icon purple-bg">ğŸ“Š</div>
            <div class="stat-info">
                <span>Ù…ØªÙˆØ³Ø· Ø§Ù„Ø·Ù„Ø¨</span>
                <strong>{{ average_order_value|floatformat:0 }} Ø¬.Ù…</strong>
                <small>Ù‚ÙŠÙ…Ø© Ø§Ù„ÙØ§ØªÙˆØ±Ø©</small>
            </div>
        </div>
    </section>

    <div class="main-grid">
        <aside class="best-sellers-section">
            <div class="section-header">
                <h3>Ø§Ù„Ø£ØµÙ†Ø§Ù Ø§Ù„Ø£ÙƒØ«Ø± Ù…Ø¨ÙŠØ¹Ø§Ù‹</h3>
                {% if is_manager %}
                <a href="#">ØªÙ‚Ø§Ø±ÙŠØ± Ù…ÙØµÙ„Ø©</a>
                {% endif %}
            </div>
            
            {% for item in best_sellers %}
            <div class="seller-item">
                <div class="item-icon pizza">ğŸ´</div>
                <div class="item-details">
                    <div class="item-name-row">
                        <span>{{ item.product__name }}</span>
                        <span class="count">{{ item.total_qty }} Ø·Ù„Ø¨</span>
                    </div>
                    <div class="progress-bar">
                        <div class="progress" style="width: 70%; background: #3498db;"></div>
                    </div>
                </div>
            </div>
            {% empty %}
            <p style="text-align: center; color: #95a5a6; padding-top: 20px;">Ù„Ø§ ØªÙˆØ¬Ø¯ Ù…Ø¨ÙŠØ¹Ø§Øª Ù…Ø³Ø¬Ù„Ø© Ø§Ù„ÙŠÙˆÙ….</p>
            {% endfor %}

            <div class="daily-goal">
                <div class="goal-info">
                    <span>ØªØ­Ù‚ÙŠÙ‚ Ø§Ù„Ù‡Ø¯Ù Ø§Ù„ÙŠÙˆÙ…ÙŠ</span>
                    <strong>82%</strong>
                </div>
                <div class="progress-bar-large"><div class="progress" style="width: 82%;"></div></div>
            </div>
        </aside>

        <main class="active-orders-section">
            <div class="section-header">
                <a href="#" class="view-all">Ø¹Ø±Ø¶ Ø§Ù„ÙƒÙ„</a>
                <h3>Ø§Ù„Ø·Ù„Ø¨Ø§Øª Ø§Ù„Ù†Ø´Ø·Ø© ({{ active_orders.count }})</h3>
            </div>

            <div class="orders-grid">
                {% for order in active_orders %}
                <div class="order-card">
                    <div class="order-header">
                        <span class="table-tag">Ø·Ù„Ø¨ #{{ order.id }}</span>
                        <span class="order-id">{{ order.created_at|date:"H:i" }}</span>
                    </div>
                    
                    <div class="order-status">
                         <span class="status-badge">{{ order.status }}</span>
                    </div>

                    <div class="order-items">
                        {% for item in order.items.all %}
                        <div class="item">
                            <span>{{ item.quantity }}x {{ item.product.name }}</span>
                            <span>{{ item.price }} Ø¬.Ù…</span>
                        </div>
                        {% endfor %}
                    </div>
                    
                    <div class="order-footer">
                        <div class="total"><span>Ø§Ù„Ø¥Ø¬Ù…Ø§Ù„ÙŠ</span> <strong>{{ order.total_price }} Ø¬.Ù…</strong></div>
                        <div class="actions">
                            <button class="btn-edit">ØªØ¹Ø¯ÙŠÙ„</button>
                            <button class="btn-ready">Ø¥ØªÙ…Ø§Ù…</button>
                        </div>
                    </div>
                </div>
                {% empty %}
                <div style="text-align: center; width: 100%; padding: 50px; color: #95a5a6;">
                    <p>Ù„Ø§ ØªÙˆØ¬Ø¯ Ø·Ù„Ø¨Ø§Øª Ù†Ø´Ø·Ø© Ø­Ø§Ù„ÙŠØ§Ù‹</p>
                </div>
                {% endfor %}
            </div>
        </main>
    </div>
</div>
{% endblock %}