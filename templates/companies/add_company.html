{% extends 'base.html' %}
{% load static %}

{% block extra_css %}
<link rel="stylesheet" href="{% static 'css/add_company.css' %}">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css">
<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/flatpickr/dist/flatpickr.min.css">
<title>Ø¥Ø¶Ø§ÙØ© Ø´Ø±ÙƒØ© Ø¬Ø¯ÙŠØ¯Ø© - Ù†Ø¸Ø§Ù… Ø¥Ø¯Ø§Ø±Ø© Ø§Ù„Ø´Ø±ÙƒØ§Øª</title>
<meta name="title" content="Ø¥Ø¶Ø§ÙØ© Ø´Ø±ÙƒØ© Ø¬Ø¯ÙŠØ¯Ø© - Ù†Ø¸Ø§Ù… Ø¥Ø¯Ø§Ø±Ø© Ø§Ù„Ø´Ø±ÙƒØ§Øª">
<meta name="description" content="Ø£Ø¶Ù Ø´Ø±ÙƒØ© Ø¬Ø¯ÙŠØ¯Ø© Ø¥Ù„Ù‰ Ù†Ø¸Ø§Ù… Ø¥Ø¯Ø§Ø±Ø© Ø§Ù„Ø´Ø±ÙƒØ§Øª.">
{% endblock %}

{% block content %}
<div class="company-form-container">
  <!-- Header -->
  <div class="form-header">
    <div class="header-content">
      <a href="{% url 'company_list' %}" class="back-link">
        <i class="fas fa-arrow-right"></i>
        Ø§Ù„Ø¹ÙˆØ¯Ø© Ù„Ù„Ù‚Ø§Ø¦Ù…Ø©
      </a>
      <h1 class="page-title">
        <i class="fas fa-building"></i>
        Ø¥Ø¶Ø§ÙØ© Ø´Ø±ÙƒØ© Ø¬Ø¯ÙŠØ¯Ø©
      </h1>
      <p class="page-subtitle">Ø§Ù…Ù„Ø£ Ø§Ù„Ù†Ù…ÙˆØ°Ø¬ Ø£Ø¯Ù†Ø§Ù‡ Ù„Ø¥Ø¶Ø§ÙØ© Ø´Ø±ÙƒØ© Ø¬Ø¯ÙŠØ¯Ø© Ø¥Ù„Ù‰ Ø§Ù„Ù†Ø¸Ø§Ù…</p>
    </div>
    <div class="header-icon">
      <i class="fas fa-plus-circle"></i>
    </div>
  </div>

  <!-- Messages -->
  {% if messages %}
  <div class="messages-container">
    {% for message in messages %}
    <div class="message alert-{{ message.tags }}">
      <div class="message-icon">
        {% if message.tags == 'success' %}
        <i class="fas fa-check-circle"></i>
        {% elif message.tags == 'error' %}
        <i class="fas fa-exclamation-circle"></i>
        {% elif message.tags == 'warning' %}
        <i class="fas fa-exclamation-triangle"></i>
        {% else %}
        <i class="fas fa-info-circle"></i>
        {% endif %}
      </div>
      <div class="message-content">
        <p>{{ message }}</p>
      </div>
      <button type="button" class="close-message">
        <i class="fas fa-times"></i>
      </button>
    </div>
    {% endfor %}
  </div>
  {% endif %}

  <!-- Form -->
  <div class="form-card">
    <form method="post" class="company-form" id="addCompanyForm">
      {% csrf_token %}
      
      <!-- Company Basic Information -->
      <div class="form-section">
        <div class="section-header">
          <h2 class="section-title">
            <i class="fas fa-info-circle"></i>
            Ø§Ù„Ù…Ø¹Ù„ÙˆÙ…Ø§Øª Ø§Ù„Ø£Ø³Ø§Ø³ÙŠØ©
          </h2>
          <div class="section-actions">
            <span class="required-hint">* Ø§Ù„Ø­Ù‚ÙˆÙ„ Ø§Ù„Ù…Ø·Ù„ÙˆØ¨Ø©</span>
          </div>
        </div>
        
        <div class="form-grid">
          <!-- Name Field -->
          <div class="form-group {% if form.name.errors %}has-error{% endif %}">
            <label for="{{ form.name.id_for_label }}" class="form-label">
              <span class="label-text">
                <i class="fas fa-signature"></i>
                Ø§Ø³Ù… Ø§Ù„Ø´Ø±ÙƒØ©
                <span class="required">*</span>
              </span>
            </label>
            <div class="input-group">
              {{ form.name }}
              <div class="input-icon">
                <i class="fas fa-building"></i>
              </div>
            </div>
            {% if form.name.help_text %}
            <small class="form-help">{{ form.name.help_text }}</small>
            {% endif %}
            {% if form.name.errors %}
            <div class="error-messages">
              {% for error in form.name.errors %}
              <span class="error-message">{{ error }}</span>
              {% endfor %}
            </div>
            {% endif %}
          </div>

          <!-- Email Field (Address) -->
          <div class="form-group {% if form.email.errors %}has-error{% endif %}">
            <label for="{{ form.email.id_for_label }}" class="form-label">
              <span class="label-text">
                <i class="fas fa-map-marker-alt"></i>
                Ø¹Ù†ÙˆØ§Ù† Ø§Ù„Ø¨Ø±ÙŠØ¯ Ø§Ù„Ø§Ù„ÙƒØªØ±ÙˆÙ†ÙŠ
                <span class="required">*</span>
              </span>
            </label>
            <div class="input-group">
              {{ form.email }}
              <div class="input-icon">
                <i class="fas fa-location-dot"></i>
              </div>
            </div>
            {% if form.email.help_text %}
            <small class="form-help">{{ form.email.help_text }}</small>
            {% endif %}
            {% if form.email.errors %}
            <div class="error-messages">
              {% for error in form.email.errors %}
              <span class="error-message">{{ error }}</span>
              {% endfor %}
            </div>
            {% endif %}
          </div>

          <!-- Website Field -->
          <div class="form-group {% if form.website.errors %}has-error{% endif %}">
            <label for="{{ form.website.id_for_label }}" class="form-label">
              <span class="label-text">
                <i class="fas fa-globe"></i>
                Ù…ÙˆÙ‚Ø¹ Ø§Ù„Ø´Ø±ÙƒØ©
              </span>
            </label>
            <div class="input-group">
              {{ form.website }}
              <div class="input-icon">
                <i class="fas fa-link"></i>
              </div>
            </div>
            {% if form.website.help_text %}
            <small class="form-help">{{ form.website.help_text }}</small>
            {% endif %}
            {% if form.website.errors %}
            <div class="error-messages">
              {% for error in form.website.errors %}
              <span class="error-message">{{ error }}</span>
              {% endfor %}
            </div>
            {% endif %}
          </div>

          <!-- End Date Field -->
          <div class="form-group {% if form.end_date.errors %}has-error{% endif %}">
            <label for="{{ form.end_date.id_for_label }}" class="form-label">
              <span class="label-text">
                <i class="fas fa-calendar-times"></i>
                ØªØ§Ø±ÙŠØ® Ø§Ù„Ø§Ù†ØªÙ‡Ø§Ø¡
              </span>
            </label>
            <div class="input-group">
              {{ form.end_date }}
              <div class="input-icon">
                <i class="fas fa-calendar-alt"></i>
              </div>
            </div>
            {% if form.end_date.help_text %}
            <small class="form-help">{{ form.end_date.help_text }}</small>
            {% endif %}
            {% if form.end_date.errors %}
            <div class="error-messages">
              {% for error in form.end_date.errors %}
              <span class="error-message">{{ error }}</span>
              {% endfor %}
            </div>
            {% endif %}
          </div>

          <!-- Contract Duration Field -->
          <div class="form-group {% if form.contract_duration.errors %}has-error{% endif %}">
            <label for="{{ form.contract_duration.id_for_label }}" class="form-label">
              <span class="label-text">
                <i class="fas fa-calendar-day"></i>
                Ù…Ø¯Ø© Ø§Ù„Ø¹Ù‚Ø¯
              </span>
            </label>
            <div class="input-group">
              {{ form.contract_duration }}
              <div class="input-icon">
                <i class="fas fa-clock"></i>
              </div>
            </div>
            {% if form.contract_duration.help_text %}
            <small class="form-help">{{ form.contract_duration.help_text }}</small>
            {% endif %}
            {% if form.contract_duration.errors %}
            <div class="error-messages">
              {% for error in form.contract_duration.errors %}
              <span class="error-message">{{ error }}</span>
              {% endfor %}
            </div>
            {% endif %}
          </div>

          <!-- Site Published Field - Ù…Ø¹ ØªØ¹Ø¯ÙŠÙ„Ø§Øª Ø§Ù„Ø§Ø®ØªÙŠØ§Ø± Ø§Ù„Ù…ØªØ¹Ø¯Ø¯ -->
          <div class="form-group {% if form.site_puplished.errors %}has-error{% endif %}">
            <label for="{{ form.site_puplished.id_for_label }}" class="form-label">
              <span class="label-text">
                <i class="fas fa-satellite-dish"></i>
                Ø§Ù„Ù…ÙˆÙ‚Ø¹ Ø§Ù„Ù…Ù†Ø´ÙˆØ± Ø¹Ù„ÙŠÙ‡
              </span>
            </label>
            <div class="input-group">
              {{ form.site_puplished }}
              <div class="input-icon">
                <i class="fas fa-sitemap"></i>
              </div>
            </div>
            
            <!-- âœ… Ø¥Ø¶Ø§ÙØ© ØªÙ„Ù…ÙŠØ­Ø© Ø§Ù„Ø§Ø®ØªÙŠØ§Ø± Ø§Ù„Ù…ØªØ¹Ø¯Ø¯ -->
            <div class="multi-select-hint">
              <i class="fas fa-info-circle"></i>
              ÙŠÙ…ÙƒÙ†Ùƒ Ø§Ø®ØªÙŠØ§Ø± Ø£ÙƒØ«Ø± Ù…Ù† Ù…ÙˆÙ‚Ø¹:
              <span class="keyboard-hint">
                <kbd>Ctrl</kbd> + <kbd>Click</kbd> Ø¹Ù„Ù‰ ÙˆÙŠÙ†Ø¯ÙˆØ²/Linux |
                <kbd>Cmd</kbd> + <kbd>Click</kbd> Ø¹Ù„Ù‰ Mac
              </span>
            </div>
            
            {% if form.site_puplished.help_text %}
            <small class="form-help">{{ form.site_puplished.help_text }}</small>
            {% endif %}
            {% if form.site_puplished.errors %}
            <div class="error-messages">
              {% for error in form.site_puplished.errors %}
              <span class="error-message">{{ error }}</span>
              {% endfor %}
            </div>
            {% endif %}
          </div>
        </div>
      </div>

      <!-- Financial Information -->
      <div class="form-section">
        <div class="section-header">
          <h2 class="section-title">
            <i class="fas fa-money-bill-wave"></i>
            Ø§Ù„Ù…Ø¹Ù„ÙˆÙ…Ø§Øª Ø§Ù„Ù…Ø§Ù„ÙŠØ©
          </h2>
          <p class="section-description">Ø§Ù„ØªÙØ§ØµÙŠÙ„ Ø§Ù„Ù…Ø§Ù„ÙŠØ© Ù„Ù„Ø´Ø±ÙƒØ©</p>
        </div>
        
        <div class="form-grid">
          <!-- Amount Paid Field -->
          <div class="form-group {% if form.amount_paid.errors %}has-error{% endif %}">
            <label for="{{ form.amount_paid.id_for_label }}" class="form-label">
              <span class="label-text">
                <i class="fas fa-money-bill"></i>
                Ø§Ù„Ù…Ø¨Ù„Øº Ø§Ù„Ù…Ø¯ÙÙˆØ¹
              </span>
            </label>
            <div class="input-group">
              {{ form.amount_paid }}
              <div class="input-icon">
                <i class="fas fa-dollar-sign"></i>
              </div>
            </div>
            {% if form.amount_paid.help_text %}
            <small class="form-help">{{ form.amount_paid.help_text }}</small>
            {% endif %}
            {% if form.amount_paid.errors %}
            <div class="error-messages">
              {% for error in form.amount_paid.errors %}
              <span class="error-message">{{ error }}</span>
              {% endfor %}
            </div>
            {% endif %}
          </div>

          <!-- Contract Details Field - Ù…Ø¹ ØªØ¹Ø¯ÙŠÙ„Ø§Øª Ø§Ù„Ø§Ø®ØªÙŠØ§Ø± Ø§Ù„Ù…ØªØ¹Ø¯Ø¯ -->
          <div class="form-group {% if form.contract_details.errors %}has-error{% endif %}">
            <label for="{{ form.contract_details.id_for_label }}" class="form-label">
              <span class="label-text">
                <i class="fas fa-file-contract"></i>
                ØªÙØ§ØµÙŠÙ„ Ø§Ù„Ø¹Ù‚Ø¯
              </span>
            </label>
            <div class="input-group">
              {{ form.contract_details }}
              <div class="input-icon">
                <i class="fas fa-clipboard-list"></i>
              </div>
            </div>
            
            <!-- âœ… Ø¥Ø¶Ø§ÙØ© ØªÙ„Ù…ÙŠØ­Ø© Ø§Ù„Ø§Ø®ØªÙŠØ§Ø± Ø§Ù„Ù…ØªØ¹Ø¯Ø¯ -->
            <div class="multi-select-hint">
              <i class="fas fa-info-circle"></i>
              ÙŠÙ…ÙƒÙ†Ùƒ Ø§Ø®ØªÙŠØ§Ø± Ø£ÙƒØ«Ø± Ù…Ù† ØªÙØµÙŠÙ„:
              <span class="keyboard-hint">
                <kbd>Ctrl</kbd> + <kbd>Click</kbd> Ø¹Ù„Ù‰ ÙˆÙŠÙ†Ø¯ÙˆØ²/Linux |
                <kbd>Cmd</kbd> + <kbd>Click</kbd> Ø¹Ù„Ù‰ Mac
              </span>
            </div>
            
            {% if form.contract_details.help_text %}
            <small class="form-help">{{ form.contract_details.help_text }}</small>
            {% endif %}
            {% if form.contract_details.errors %}
            <div class="error-messages">
              {% for error in form.contract_details.errors %}
              <span class="error-message">{{ error }}</span>
              {% endfor %}
            </div>
            {% endif %}
          </div>
        </div>
      </div>

      <!-- Notes Section -->
      <div class="form-section">
        <div class="section-header">
          <h2 class="section-title">
            <i class="fas fa-sticky-note"></i>
            Ø§Ù„Ù…Ù„Ø§Ø­Ø¸Ø§Øª
          </h2>
          <p class="section-description">Ù…Ù„Ø§Ø­Ø¸Ø§Øª Ø¥Ø¶Ø§ÙÙŠØ© Ø¹Ù† Ø§Ù„Ø´Ø±ÙƒØ©</p>
        </div>
        
        <div class="form-grid">
          <!-- Notes Field -->
          <div class="form-group full-width {% if form.nots.errors %}has-error{% endif %}">
            <label for="{{ form.nots.id_for_label }}" class="form-label">
              <span class="label-text">
                <i class="fas fa-edit"></i>
                Ù…Ù„Ø§Ø­Ø¸Ø§Øª
              </span>
            </label>
            <div class="input-group">
              {{ form.nots }}
              <div class="input-icon textarea-icon">
                <i class="fas fa-align-left"></i>
              </div>
            </div>
            {% if form.nots.help_text %}
            <small class="form-help">{{ form.nots.help_text }}</small>
            {% endif %}
            {% if form.nots.errors %}
            <div class="error-messages">
              {% for error in form.nots.errors %}
              <span class="error-message">{{ error }}</span>
              {% endfor %}
            </div>
            {% endif %}
            <div class="character-count">
              <span id="notes-char-count">0</span> / 5000 Ø­Ø±Ù
            </div>
          </div>
        </div>
      </div>

      <!-- Form Actions -->
      <div class="form-actions">
        <div class="action-buttons">
          <button type="reset" class="btn btn-secondary">
            <i class="fas fa-redo"></i>
            Ø¥Ø¹Ø§Ø¯Ø© ØªØ¹ÙŠÙŠÙ† Ø§Ù„Ù†Ù…ÙˆØ°Ø¬
          </button>
          <button type="submit" class="btn btn-primary">
            <i class="fas fa-save"></i>
            Ø­ÙØ¸ Ø§Ù„Ø´Ø±ÙƒØ©
          </button>
          <a href="{% url 'company_list' %}" class="btn btn-outline">
            <i class="fas fa-times"></i>
            Ø¥Ù„ØºØ§Ø¡ ÙˆØ§Ù„Ø¹ÙˆØ¯Ø©
          </a>
        </div>
        <div class="form-info">
          <i class="fas fa-info-circle"></i>
          Ø³ÙŠØªÙ… Ø­ÙØ¸ ØªØ§Ø±ÙŠØ® Ø§Ù„Ø¥Ø¶Ø§ÙØ© ØªÙ„Ù‚Ø§Ø¦ÙŠØ§Ù‹ Ø¹Ù†Ø¯ Ø­ÙØ¸ Ø§Ù„Ù†Ù…ÙˆØ°Ø¬
        </div>
      </div>
    </form>
  </div>

  <!-- Help Tips -->
  <div class="help-tips">
    <h3 class="tips-title">
      <i class="fas fa-lightbulb"></i>
      Ù†ØµØ§Ø¦Ø­ Ù„Ù„Ù…Ø³ØªØ®Ø¯Ù…
    </h3>
    <div class="tips-grid">
      <div class="tip-card">
        <div class="tip-icon">
          <i class="fas fa-star"></i>
        </div>
        <div class="tip-content">
          <h4>Ø­Ù‚ÙˆÙ„ Ù…Ø·Ù„ÙˆØ¨Ø©</h4>
          <p>Ø§Ù„Ø­Ù‚ÙˆÙ„ Ø°Ø§Øª Ø§Ù„Ø¹Ù„Ø§Ù…Ø© (*) Ø¥Ù„Ø²Ø§Ù…ÙŠØ© ÙˆÙŠØ¬Ø¨ ØªØ¹Ø¨Ø¦ØªÙ‡Ø§</p>
        </div>
      </div>
      <div class="tip-card">
        <div class="tip-icon">
          <i class="fas fa-calendar-check"></i>
        </div>
        <div class="tip-content">
          <h4>ØªÙˆØ§Ø±ÙŠØ® Ø§Ù„Ø¹Ù‚Ø¯</h4>
          <p>ÙŠÙ…ÙƒÙ†Ùƒ ØªØ­Ø¯ÙŠØ¯ ØªØ§Ø±ÙŠØ® Ø§Ù„Ø§Ù†ØªÙ‡Ø§Ø¡ ÙˆÙ…Ø¯Ø© Ø§Ù„Ø¹Ù‚Ø¯ Ù„Ù„Ù…ØªØ§Ø¨Ø¹Ø©</p>
        </div>
      </div>
      <div class="tip-card">
        <div class="tip-icon">
          <i class="fas fa-mouse-pointer"></i> <!-- âœ… Ø£ÙŠÙ‚ÙˆÙ†Ø© Ø¬Ø¯ÙŠØ¯Ø© -->
        </div>
        <div class="tip-content">
          <h4>Ø§Ù„Ø§Ø®ØªÙŠØ§Ø± Ø§Ù„Ù…ØªØ¹Ø¯Ø¯</h4> <!-- âœ… ØªØ­Ø¯ÙŠØ« Ø§Ù„Ø¹Ù†ÙˆØ§Ù† -->
          <p>ÙŠÙ…ÙƒÙ†Ùƒ Ø§Ø®ØªÙŠØ§Ø± Ø£ÙƒØ«Ø± Ù…Ù† Ø®ÙŠØ§Ø± ÙÙŠ Ø­Ù‚ÙˆÙ„ "Ø§Ù„Ù…ÙˆÙ‚Ø¹ Ø§Ù„Ù…Ù†Ø´ÙˆØ± Ø¹Ù„ÙŠÙ‡" Ùˆ"ØªÙØ§ØµÙŠÙ„ Ø§Ù„Ø¹Ù‚Ø¯"</p> <!-- âœ… ØªØ­Ø¯ÙŠØ« Ø§Ù„Ù†Øµ -->
        </div>
      </div>
      <div class="tip-card">
        <div class="tip-icon">
          <i class="fas fa-edit"></i>
        </div>
        <div class="tip-content">
          <h4>Ø§Ù„Ù…Ù„Ø§Ø­Ø¸Ø§Øª</h4>
          <p>Ø£Ø¶Ù Ø£ÙŠ Ù…Ù„Ø§Ø­Ø¸Ø§Øª Ø¥Ø¶Ø§ÙÙŠØ© ÙÙŠ Ø­Ù‚Ù„ Ø§Ù„Ù…Ù„Ø§Ø­Ø¸Ø§Øª</p>
        </div>
      </div>
    </div>
  </div>
</div>
{% endblock %}

{% block extra_js %}
<script src="https://cdn.jsdelivr.net/npm/flatpickr"></script>
<script src="https://cdn.jsdelivr.net/npm/flatpickr/dist/l10n/ar.js"></script>
<script>
  // Initialize date picker
  document.addEventListener('DOMContentLoaded', function() {
    // End date picker
    const endDateInput = document.getElementById('{{ form.end_date.id_for_label }}');
    if (endDateInput) {
      flatpickr(endDateInput, {
        locale: "ar",
        dateFormat: "Y-m-d",
        allowInput: true,
        altInput: true,
        altFormat: "Y/m/d",
        minDate: "today",
      });
    }

    // Character count for notes
    const notesTextarea = document.getElementById('{{ form.nots.id_for_label }}');
    const charCountElement = document.getElementById('notes-char-count');
    
    if (notesTextarea && charCountElement) {
      function updateCharCount() {
        const count = notesTextarea.value.length;
        charCountElement.textContent = count;
        
        if (count > 5000) {
          charCountElement.style.color = '#e74c3c';
        } else if (count > 4000) {
          charCountElement.style.color = '#f39c12';
        } else {
          charCountElement.style.color = '#27ae60';
        }
      }
      
      notesTextarea.addEventListener('input', updateCharCount);
      updateCharCount(); // Initial count
    }

    // Close message buttons
    document.querySelectorAll('.close-message').forEach(button => {
      button.addEventListener('click', function() {
        this.closest('.message').style.display = 'none';
      });
    });

    // Auto-hide success messages after 5 seconds
    setTimeout(() => {
      document.querySelectorAll('.message.alert-success').forEach(message => {
        message.style.opacity = '0';
        setTimeout(() => {
          message.style.display = 'none';
        }, 300);
      });
    }, 5000);

    // ğŸ”„ ØªØ­Ø³ÙŠÙ† Ø­Ù‚ÙˆÙ„ Ø§Ù„Ø§Ø®ØªÙŠØ§Ø± Ø§Ù„Ù…ØªØ¹Ø¯Ø¯
    const multiSelects = document.querySelectorAll('select[multiple]');
    
    multiSelects.forEach(select => {
      // Ø¥Ø¶Ø§ÙØ© Ù…Ø¤Ø´Ø± Ø¹Ø¯Ø¯ Ø§Ù„Ø¹Ù†Ø§ØµØ± Ø§Ù„Ù…Ø®ØªØ§Ø±Ø©
      function updateSelectionCount() {
        const selectedCount = Array.from(select.selectedOptions).length;
        let badge = select.parentNode.querySelector('.selection-badge');
        
        if (!badge && selectedCount > 0) {
          badge = document.createElement('span');
          badge.className = 'multi-select-badge selection-badge';
          select.parentNode.appendChild(badge);
        }
        
        if (badge) {
          badge.textContent = `${selectedCount} Ù…Ø®ØªØ§Ø±`;
          badge.style.display = selectedCount > 0 ? 'inline-block' : 'none';
        }
      }
      
      // ØªØ­Ø¯ÙŠØ« Ø§Ù„Ø¹Ø¯ Ø¹Ù†Ø¯ Ø§Ù„ØªØºÙŠÙŠØ±
      select.addEventListener('change', updateSelectionCount);
      
      // Ø§Ù„Ø¹Ø¯ Ø§Ù„Ø£ÙˆÙ„ÙŠ
      updateSelectionCount();
      
      // ØªÙ…ÙŠÙŠØ² Ø§Ù„Ø®ÙŠØ§Ø±Ø§Øª Ø¹Ù†Ø¯ Ø§Ù„Ù…Ø±ÙˆØ± Ø¹Ù„ÙŠÙ‡Ø§
      select.addEventListener('mouseover', function(e) {
        if (e.target.tagName === 'OPTION') {
          e.target.style.backgroundColor = '#f0f8ff';
        }
      });
      
      select.addEventListener('mouseout', function(e) {
        if (e.target.tagName === 'OPTION' && !e.target.selected) {
          e.target.style.backgroundColor = '';
        }
      });
    });

    // Form validation
    const form = document.getElementById('addCompanyForm');
    form.addEventListener('submit', function(e) {
      const nameField = document.getElementById('{{ form.name.id_for_label }}');
      const emailField = document.getElementById('{{ form.email.id_for_label }}');
      
      let isValid = true;
      
      // Validate required fields
      if (!nameField.value.trim()) {
        showFieldError(nameField, 'ÙŠØ±Ø¬Ù‰ Ø¥Ø¯Ø®Ø§Ù„ Ø§Ø³Ù… Ø§Ù„Ø´Ø±ÙƒØ©');
        isValid = false;
      }
      
      if (!emailField.value.trim()) {
        showFieldError(emailField, 'ÙŠØ±Ø¬Ù‰ Ø¥Ø¯Ø®Ø§Ù„ Ø¹Ù†ÙˆØ§Ù† Ø§Ù„Ø´Ø±ÙƒØ©');
        isValid = false;
      }
      
      if (!isValid) {
        e.preventDefault();
        showAlert('error', 'ÙŠØ±Ø¬Ù‰ ØªØ¹Ø¨Ø¦Ø© Ø§Ù„Ø­Ù‚ÙˆÙ„ Ø§Ù„Ù…Ø·Ù„ÙˆØ¨Ø©');
      }
    });

    function showFieldError(field, message) {
      const formGroup = field.closest('.form-group');
      if (!formGroup.querySelector('.error-message')) {
        const errorDiv = document.createElement('div');
        errorDiv.className = 'error-messages';
        errorDiv.innerHTML = `<span class="error-message">${message}</span>`;
        formGroup.appendChild(errorDiv);
        formGroup.classList.add('has-error');
      }
    }

    function showAlert(type, message) {
      const messagesContainer = document.querySelector('.messages-container') || 
        document.querySelector('.form-card').insertBefore(
          document.createElement('div'), 
          document.querySelector('.form-card').firstChild
        );
      
      const alertDiv = document.createElement('div');
      alertDiv.className = `message alert-${type}`;
      alertDiv.innerHTML = `
        <div class="message-icon">
          <i class="fas fa-exclamation-circle"></i>
        </div>
        <div class="message-content">
          <p>${message}</p>
        </div>
        <button type="button" class="close-message">
          <i class="fas fa-times"></i>
        </button>
      `;
      
      messagesContainer.appendChild(alertDiv);
      
      // Add click event to close button
      alertDiv.querySelector('.close-message').addEventListener('click', function() {
        alertDiv.style.display = 'none';
      });
      
      // Auto remove after 5 seconds
      setTimeout(() => {
        alertDiv.style.opacity = '0';
        setTimeout(() => {
          alertDiv.style.display = 'none';
        }, 300);
      }, 5000);
    }

    // Clear error when user starts typing
    document.querySelectorAll('input, textarea, select').forEach(field => {
      field.addEventListener('input', function() {
        const formGroup = this.closest('.form-group');
        if (formGroup.classList.contains('has-error')) {
          const errorMessages = formGroup.querySelector('.error-messages');
          if (errorMessages) {
            errorMessages.remove();
          }
          formGroup.classList.remove('has-error');
        }
      });
    });
  });
</script>
{% endblock %}