{% extends 'base.html' %}
{% load static %}

{% block extra_css %}
<link rel="stylesheet" href="{% static 'css/order_detail.css' %}">
{% endblock %}

{% block content %}
<div class="order-detail-container">
    <div class="detail-header">
        <a href="{% url 'orders' %}" class="back-link">â†’ Ø§Ù„Ø¹ÙˆØ¯Ø© Ù„Ù„Ø³Ø¬Ù„</a>
        <h1>ØªÙØ§ØµÙŠÙ„ Ø§Ù„Ø·Ù„Ø¨ #{{ order.id }}</h1>
        <span class="status-badge status-{{ order.status.id }}">{{ order.status.name }}</span>
    </div>

    <div class="detail-grid">
        <div class="info-card">
            <h3>ğŸ“‹ Ù…Ø¹Ù„ÙˆÙ…Ø§Øª Ø§Ù„Ø·Ù„Ø¨</h3>
            <div class="info-row"><span>Ø§Ù„ØªØ§Ø±ÙŠØ®:</span> <strong>{{ order.created_at|date:"d/m/Y H:i" }}</strong></div>
            <div class="info-row"><span>Ø§Ù„Ù…ÙˆØ¸Ù:</span> <strong>{{ order.user.get_full_name }}</strong></div>
            <div class="info-row"><span>Ø·Ø±ÙŠÙ‚Ø© Ø§Ù„Ø¯ÙØ¹:</span> <strong>{{ order.get_payment_method_display }}</strong></div>
            <div class="info-row grand-total"><span>Ø§Ù„Ø¥Ø¬Ù…Ø§Ù„ÙŠ Ø§Ù„Ù†Ù‡Ø§Ø¦ÙŠ:</span> <strong>{{ order.total_price }} Ø¬.Ù…</strong></div>
        </div>

        <div class="actions-card">
            <h3>âš™ï¸ Ø§Ù„Ø¥Ø¬Ø±Ø§Ø¡Ø§Øª Ø§Ù„Ù…ØªØ§Ø­Ø©</h3>
            
            <form method="POST" action="{% url 'process_order_action' order.id %}">
                {% csrf_token %}
                
                <button type="submit" name="action" value="return" class="btn-action return" 
                        onclick="return confirm('Ù‡Ù„ Ø£Ù†Øª Ù…ØªØ£ÙƒØ¯ Ù…Ù† Ø¥Ø±Ø¬Ø§Ø¹ Ù‡Ø°Ø§ Ø§Ù„Ø·Ù„Ø¨ØŸ')">ğŸ”„ Ø¥Ø±Ø¬Ø§Ø¹ Ø§Ù„Ø·Ù„Ø¨</button>

                {% if request.user.role == 'manager' %}
                    <hr>
                    <p class="admin-note">ØµÙ„Ø§Ø­ÙŠØ§Øª Ø§Ù„Ù…Ø¯ÙŠØ±:</p>
                    
                    <div class="edit-group">
                        <select name="payment_method" class="custom-select">
                            <option value="cash" {% if order.payment_method == 'cash' %}selected{% endif %}>Ù†Ù‚Ø¯Ø§Ù‹</option>
                            <option value="visa" {% if order.payment_method == 'visa' %}selected{% endif %}>ÙÙŠØ²Ø§</option>
                        </select>
                        <button type="submit" name="action" value="edit_payment" class="btn-action edit">ØªØ¹Ø¯ÙŠÙ„ Ø§Ù„Ø¯ÙØ¹</button>
                    </div>

                    <button type="submit" name="action" value="delete" class="btn-action delete" 
                            onclick="return confirm('ØªØ­Ø°ÙŠØ±: Ø³ÙŠØªÙ… Ø­Ø°Ù Ø§Ù„Ø·Ù„Ø¨ Ù†Ù‡Ø§Ø¦ÙŠØ§Ù‹ Ù…Ù† Ø§Ù„Ù†Ø¸Ø§Ù…. Ù‡Ù„ Ø£Ù†Øª Ù…ØªØ£ÙƒØ¯ØŸ')">ğŸ—‘ï¸ Ø­Ø°Ù Ù†Ù‡Ø§Ø¦ÙŠ</button>
                {% endif %}
            </form>
        </div>
    </div>

    <div class="items-card">
        <h3>ğŸ“¦ Ù…Ø­ØªÙˆÙŠØ§Øª Ø§Ù„Ø·Ù„Ø¨</h3>
        <table class="items-table">
            <thead>
                <tr>
                    <th>Ø§Ù„ØµÙ†Ù</th>
                    <th>Ø§Ù„ÙƒÙ…ÙŠØ©</th>
                    <th>Ø³Ø¹Ø± Ø§Ù„ÙˆØ­Ø¯Ø©</th>
                    <th>Ø§Ù„Ø¥Ø¬Ù…Ø§Ù„ÙŠ</th>
                </tr>
            </thead>
            <tbody>
                {% for item in order.items.all %}
                <tr>
                    <td>{{ item.product.name }}</td>
                    <td>{{ item.quantity }}</td>
                    <td>{{ item.product.price }} Ø¬.Ù…</td>
                    <td>{{ item.get_total_item_price }} Ø¬.Ù…</td>
                </tr>
                {% endfor %}
            </tbody>
        </table>
    </div>
</div>
{% endblock %}