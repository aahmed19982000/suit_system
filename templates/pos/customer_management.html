{% extends 'base.html' %}
{% load static %}

{% block title %}Ø¥Ø¯Ø§Ø±Ø© Ø§Ù„Ø¹Ù…Ù„Ø§Ø¡ - ÙØ·Ø§Ø·Ø±ÙŠ Ø§Ù„Ø¨Ø±ÙƒØ©{% endblock %}

{% block extra_css %}
<link rel="stylesheet" href="{% static 'css/customers.css' %}">
<link href="https://fonts.googleapis.com/css2?family=Cairo:wght@400;600;700&display=swap" rel="stylesheet">
<style>
    /* ØªØ­Ø³ÙŠÙ†Ø§Øª Ø¥Ø¶Ø§ÙÙŠØ© Ù„Ù„ØªÙˆØ§ÙÙ‚ Ù…Ø¹ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ø¯ÙŠÙ†Ø§Ù…ÙŠÙƒÙŠØ© */
    .admin-container { direction: rtl; font-family: 'Cairo', sans-serif; }
    .stat-trend.up { color: #2ecc71; font-weight: bold; }
    .user-avatar { 
        width: 40px; height: 40px; border-radius: 50%; 
        display: flex; align-items: center; justify-content: center; 
        font-weight: bold; font-size: 1.2rem;
    }
    .order-count { background: #e8f5e9; color: #2e7d32; padding: 4px 8px; border-radius: 12px; font-size: 0.85rem; }
    .loyalty-points { color: #f39c12; font-weight: bold; }
    .tab-btn { text-decoration: none; display: inline-block; }
    .search-box button { background: none; border: none; cursor: pointer; }
    
    /* ØªÙ†Ø³ÙŠÙ‚ Ø§Ù„ØªÙ‚Ø³ÙŠÙ… Ù„ØµÙØ­Ø§Øª */
    .pagination a { text-decoration: none; color: inherit; }
    .page-num.active { background-color: #3498db; color: white; border: none; }
</style>
{% endblock %}

{% block content %}
<div class="admin-container">
    <header class="admin-header">
        <div class="header-title">
            <h1>Ø¥Ø¯Ø§Ø±Ø© Ø§Ù„Ø¹Ù…Ù„Ø§Ø¡</h1>
            <p>Ø¥Ø¯Ø§Ø±Ø© Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ø¹Ù…Ù„Ø§Ø¡ØŒ Ø³Ø¬Ù„Ø§Øª Ø§Ù„Ø·Ù„Ø¨Ø§ØªØŒ ÙˆØ¥Ø­ØµØ§Ø¦ÙŠØ§Øª Ø§Ù„ØªÙØ§Ø¹Ù„</p>
        </div>
        <button class="btn-add-customer" onclick="alert('Ø³ÙŠØªÙ… Ø¥Ø¶Ø§ÙØ© Ù†Ø§ÙØ°Ø© ØªØ³Ø¬ÙŠÙ„ Ø¹Ù…ÙŠÙ„ Ø¬Ø¯ÙŠØ¯ Ù‚Ø±ÙŠØ¨Ø§Ù‹')">+ Ø¥Ø¶Ø§ÙØ© Ø¹Ù…ÙŠÙ„ Ø¬Ø¯ÙŠØ¯</button>
    </header>

    <section class="stats-grid">
        <div class="stat-card">
            <div class="stat-info">
                <span class="stat-label">Ø¥Ø¬Ù…Ø§Ù„ÙŠ Ø§Ù„Ø¹Ù…Ù„Ø§Ø¡</span>
                <strong class="stat-value">{{ total_customers }}</strong>
                <small class="stat-trend up">Ù…Ø­Ø¯Ø« Ø§Ù„Ø¢Ù†</small>
            </div>
            <div class="stat-icon blue">ğŸ‘¥</div>
        </div>
        <div class="stat-card">
            <div class="stat-info">
                <span class="stat-label">Ø¹Ù…Ù„Ø§Ø¡ Ø¬Ø¯Ø¯</span>
                <strong class="stat-value">{{ new_customers_count }}</strong>
                <small class="stat-trend up">Ù‡Ø°Ø§ Ø§Ù„Ø´Ù‡Ø±</small>
            </div>
            <div class="stat-icon purple">ğŸ‘¤</div>
        </div>
        <div class="stat-card">
            <div class="stat-info">
                <span class="stat-label">Ø§Ù„Ø¹Ù…Ù„Ø§Ø¡ Ø§Ù„Ù†Ø´Ø·ÙŠÙ†</span>
                <strong class="stat-value">{{ active_customers }}</strong>
                <small class="stat-trend up">Ø·Ù„Ø¨Ø§Øª +5</small>
            </div>
            <div class="stat-icon green">ğŸ”¥</div>
        </div>
        <div class="stat-card">
            <div class="stat-info">
                <span class="stat-label">Ù…ØªÙˆØ³Ø· Ø§Ù„Ø·Ù„Ø¨Ø§Øª</span>
                <strong class="stat-value">{{ avg_orders }}</strong>
                <small class="stat-trend up">Ù„ÙƒÙ„ Ø¹Ù…ÙŠÙ„</small>
            </div>
            <div class="stat-icon orange">ğŸ“Š</div>
        </div>
    </section>

    <section class="filter-section">
        <form method="GET" action="." class="search-box">
            <input type="text" name="search" placeholder="Ø¨Ø­Ø« Ø¨Ø§Ø³Ù… Ø§Ù„Ø¹Ù…ÙŠÙ„ Ø£Ùˆ Ø±Ù‚Ù… Ø§Ù„Ù‡Ø§ØªÙ..." value="{{ search_query }}">
            <input type="hidden" name="tab" value="{{ current_tab }}">
            <button type="submit" class="search-icon">ğŸ”</button>
        </form>
        
        <div class="filter-tabs">
            <a href="?tab=all&search={{ search_query }}" class="tab-btn {% if current_tab == 'all' or not current_tab %}active{% endif %}">Ø§Ù„ÙƒÙ„</a>
            <a href="?tab=frequent&search={{ search_query }}" class="tab-btn {% if current_tab == 'frequent' %}active{% endif %}">Ø§Ù„Ø£ÙƒØ«Ø± Ø·Ù„Ø¨Ø§Ù‹</a>
            <a href="?tab=new&search={{ search_query }}" class="tab-btn {% if current_tab == 'new' %}active{% endif %}">Ø¹Ù…Ù„Ø§Ø¡ Ø¬Ø¯Ø¯</a>
        </div>
    </section>

    <div class="table-wrapper">
        <table class="data-table">
            <thead>
                <tr>
                    <th>Ø§Ù„Ø¹Ù…ÙŠÙ„</th>
                    <th>Ø±Ù‚Ù… Ø§Ù„Ù‡Ø§ØªÙ</th>
                    <th>Ø§Ù„Ø¹Ù†ÙˆØ§Ù† Ø§Ù„Ù…Ù„Ø­ÙˆØ¸</th>
                    <th>Ø¹Ø¯Ø¯ Ø§Ù„Ø·Ù„Ø¨Ø§Øª</th>
                    <th>Ø§Ù„Ù†Ù‚Ø§Ø· Ø§Ù„ØªÙ‚Ø¯ÙŠØ±ÙŠØ©</th>
                    <th>Ø§Ù„Ø¥Ø¬Ø±Ø§Ø¡Ø§Øª</th>
                </tr>
            </thead>
            <tbody>
                {% for customer in customers %}
                <tr>
                    <td class="user-cell">
                        <div class="user-avatar" style="background-color: #e3f2fd; color: #2196f3;">
                            {{ customer.name|slice:":1"|upper }}
                        </div>
                        <div class="user-meta">
                            <strong>{{ customer.name }}</strong>
                            <span>Ù…Ø¹Ø±Ù Ø§Ù„Ø¹Ù…ÙŠÙ„: #{{ customer.id }}</span>
                        </div>
                    </td>
                    <td class="phone-cell">{{ customer.mobil }}</td>
                    <td>{{ customer.address|truncatechars:40 }}</td>
                    <td><span class="order-count">{{ customer.number_of_orders }} Ø·Ù„Ø¨</span></td>
                    <td><span class="loyalty-points">{{ customer.number_of_orders }} â­</span></td>
                    <td>
                        <div class="action-dropdown">
                            <button class="btn-details" onclick="window.location.href='#'">Ø¹Ø±Ø¶ Ø§Ù„Ø³Ø¬Ù„</button>
                            <button class="btn-more">â‹®</button>
                        </div>
                    </td>
                </tr>
                {% empty %}
                <tr>
                    <td colspan="6" style="text-align: center; padding: 50px; color: #95a5a6;">
                        Ù„Ø§ ÙŠÙˆØ¬Ø¯ Ø¹Ù…Ù„Ø§Ø¡ Ù…Ø³Ø¬Ù„ÙŠÙ† Ø­Ø§Ù„ÙŠØ§Ù‹ Ø£Ùˆ Ù„Ø§ ØªÙˆØ¬Ø¯ Ù†ØªØ§Ø¦Ø¬ Ù„Ù„Ø¨Ø­Ø«.
                    </td>
                </tr>
                {% endfor %}
            </tbody>
        </table>
    </div>

    <footer class="table-footer">
        <div class="pagination">
            {% if customers.has_next %}
                <a href="?page={{ customers.next_page_number }}&tab={{ current_tab }}&search={{ search_query }}" class="page-nav">â€º</a>
            {% endif %}

            {% for num in customers.paginator.page_range %}
                {% if customers.number == num %}
                    <button class="page-num active">{{ num }}</button>
                {% elif num > customers.number|add:'-3' and num < customers.number|add:'3' %}
                    <a href="?page={{ num }}&tab={{ current_tab }}&search={{ search_query }}" class="page-num">{{ num }}</a>
                {% endif %}
            {% endfor %}

            {% if customers.has_previous %}
                <a href="?page={{ customers.previous_page_number }}&tab={{ current_tab }}&search={{ search_query }}" class="page-nav">â€¹</a>
            {% endif %}
        </div>
        
        <div class="results-info">
            Ø¹Ø±Ø¶ {{ customers.start_index }} Ø¥Ù„Ù‰ {{ customers.end_index }} Ù…Ù† Ø£ØµÙ„ {{ total_customers }} Ø¹Ù…ÙŠÙ„
        </div>
    </footer>
</div>

<script>
    // ÙŠÙ…ÙƒÙ† Ø¥Ø¶Ø§ÙØ© JavaScript Ù‡Ù†Ø§ Ù„Ù„ØªØ¹Ø§Ù…Ù„ Ù…Ø¹ Ø§Ù„Ù€ Dropdowns Ø£Ùˆ Ø§Ù„Ù€ Modals
    document.addEventListener('DOMContentLoaded', function() {
        console.log("Customer Management Loaded");
    });
</script>
{% endblock %}