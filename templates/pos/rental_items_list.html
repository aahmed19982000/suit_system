{% extends 'base.html' %}
{% load static %}

{% block title %}Ø³Ø¬Ù„ Ø·Ù„Ø¨Ø§Øª Ø§Ù„Ø¥ÙŠØ¬Ø§Ø±{% endblock %}

{% block extra_css %}
<link rel="stylesheet" href="{% static 'css/rental_items.css' %}">
<style>
    /* Ø¥Ø¶Ø§ÙØ§Øª Ø¨Ø³ÙŠØ·Ø© Ù„ØªØ¹Ø²ÙŠØ² Ø§Ù„Ù…Ø¸Ù‡Ø± Ø¯ÙˆÙ† ØªØ¶Ø§Ø±Ø¨ Ù…Ø¹ Ù…Ù„ÙÙƒ */
    .status-dropdown {
        padding: 5px;
        border-radius: 5px;
        border: 1px solid #ddd;
        font-family: 'Cairo', sans-serif;
    }
    /* Ø£Ù„ÙˆØ§Ù† Ø§Ù„Ø­Ø§Ù„Ø© Ø¨Ù†Ø§Ø¡Ù‹ Ø¹Ù„Ù‰ Ø§Ù„Ù†Øµ Ø§Ù„Ù…ÙˆØ¬ÙˆØ¯ ÙÙŠ Ù‚Ø§Ø¹Ø¯Ø© Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª */
    .row-Ù…Ø­Ø¬ÙˆØ² { border-right: 5px solid #ffc107; }
    .row-Ù†ÙØ°Ù‡ { border-right: 5px solid #17a2b8; }
    .row-Ù…ØªÙˆÙØ± { border-right: 5px solid #28a745; }
    .row-Ù…ØªØ£Ø®Ø± { border-right: 5px solid #dc3545; }
    
    .notes-tooltip { cursor: help; color: #6c757d; }
</style>
{% endblock %}

{% block content %}
<div class="rental-container">
    <header class="page-header">
        <h2><i class="fas fa-suit"></i> Ù„ÙˆØ­Ø© ØªØ­ÙƒÙ… Ø§Ù„Ø¥ÙŠØ¬Ø§Ø±Ø§Øª</h2>
    </header>

    <div class="stats-grid">
        <div class="stat-card gold-border">
            <div class="stat-icon">ğŸ“‹</div>
            <div class="stat-info">
                <span class="label">Ø¥Ø¬Ù…Ø§Ù„ÙŠ Ø§Ù„Ø·Ù„Ø¨Ø§Øª</span>
                <strong class="value">{{ stats.total_orders }}</strong>
            </div>
        </div>
        <div class="stat-card green-border">
            <div class="stat-icon">ğŸ’°</div>
            <div class="stat-info">
                <span class="label">Ø¥Ø¬Ù…Ø§Ù„ÙŠ Ø§Ù„Ø¥ÙŠØ±Ø§Ø¯Ø§Øª</span>
                <strong class="value">{{ stats.total_revenue }} Ø¬.Ù…</strong>
            </div>
        </div>
        <div class="stat-card blue-border">
            <div class="stat-icon">ğŸ›¡ï¸</div>
            <div class="stat-info">
                <span class="label">ØªØ£Ù…ÙŠÙ†Ø§Øª Ù…Ø­ØªØ¬Ø²Ø©</span>
                <strong class="value">{{ stats.total_deposit }} Ø¬.Ù…</strong>
            </div>
        </div>
        <div class="stat-card red-border">
            <div class="stat-icon">âš ï¸</div>
            <div class="stat-info">
                <span class="label">Ø·Ù„Ø¨Ø§Øª Ù…ØªØ£Ø®Ø±Ø©</span>
                <strong class="value">{{ stats.late_count }}</strong>
            </div>
        </div>
    </div>

    <section class="filter-bar">
        <form method="GET" action="" class="filter-form">
            <div class="filter-group">
                <input type="text" name="search_id" placeholder="Ø¨Ø­Ø« Ø¨Ø§Ø³Ù… Ø§Ù„Ø¹Ù…ÙŠÙ„ Ø£Ùˆ Ø§Ù„ÙƒÙˆØ¯..." value="{{ search_query }}">
            </div>
            <div class="filter-group">
                <select name="status_filter">
                    <option value="">ÙƒÙ„ Ø§Ù„Ø­Ø§Ù„Ø§Øª</option>
                    {% for st in all_statuses %}
                    <option value="{{ st.id }}" {% if status_filter == st.id|stringformat:"i" %}selected{% endif %}>{{ st.status }}</option>
                    {% endfor %}
                </select>
            </div>
            <div class="filter-group">
                <input type="date" name="start_date" value="{{ start_date }}">
                <input type="date" name="end_date" value="{{ end_date }}">
            </div>
            <button type="submit" class="btn-filter">ØªØ·Ø¨ÙŠÙ‚ Ø§Ù„ÙÙ„ØªØ±</button>
            <a href="{% url 'all_rental_items' %}" class="btn-reset">Ø¥Ø¹Ø§Ø¯Ø© ØªØ¹ÙŠÙŠÙ†</a>
        </form>
    </section>

    <div class="rental-table-container">
        <table class="table" id="suitTable">
            <thead>
                <tr>
                    <th>Ø§Ù„Ø¹Ù…ÙŠÙ„</th>
                    <th>Ø§Ù„Ø¨Ø¯Ù„Ø© (UID)</th>
                    <th>ØªØ§Ø±ÙŠØ® Ø§Ù„Ø¥ÙŠØ¬Ø§Ø±</th>
                    <th>ØªØ§Ø±ÙŠØ® Ø§Ù„Ø¹ÙˆØ¯Ø©</th>
                    <th>Ø§Ù„Ø¥ÙŠØ¬Ø§Ø±</th>
                    <th>Ø§Ù„ØªØ£Ù…ÙŠÙ†</th>
                    <th>Ø§Ù„Ø­Ø§Ù„Ø©</th>
                    <th>Ø¥Ø¬Ø±Ø§Ø¡Ø§Øª</th>
                </tr>
            </thead>
            <tbody>
                {% for item in items %}
                <tr class="item-row row-{{ item.status.status }}">                    
                    <td>
                        <strong>{{ item.customer.name }}</strong>
                        <br><small>{{ item.customer.mobil }}</small>
                    </td>
                    <td>
                        {{ item.item.item.name }}
                        <br><small class="text-gold">{{ item.item.UID }}</small>
                    </td>
                    <td>{{ item.rental_date|date:"Y-m-d" }}</td>
                    <td class="{% if item.status.status == 'Ù…ØªØ£Ø®Ø±' %}text-danger fw-bold{% endif %}">
                        {{ item.return_date|date:"Y-m-d" }}
                    </td>
                    <td class="text-green">{{ item.total_price }} Ø¬.Ù…</td>
                    <td>{{ item.deposit_amount }} Ø¬.Ù…</td>
                    <td>
                        <form method="POST" action="{% url 'update_rental_status' item.id %}">
                            {% csrf_token %}
                            <select name="status_id" class="status-dropdown" onchange="this.form.submit()">
                                {% for status_choice in all_statuses %}
                                    <option value="{{ status_choice.id }}" {% if item.status.id == status_choice.id %}selected{% endif %}>
                                        {{ status_choice.status }}
                                    </option>
                                {% endfor %}
                            </select>
                        </form>
                    </td>
                    <td>
                        <a href="{% url 'customer_history' item.customer.id %}" class="btn-view" title="Ø³Ø¬Ù„ Ø§Ù„Ø¹Ù…ÙŠÙ„">ğŸ‘¤</a>
                        <a href="{% url 'edit_rental_order' item.id %}" class="btn-edit">
                            ØªØ¹Ø¯ÙŠÙ„ Ø§Ù„Ø·Ù„Ø¨ ğŸ“
                        </a>
                    </td>
                </tr>
                {% endfor %}
            </tbody>
        </table>
    </div>
</div>
{% endblock %}